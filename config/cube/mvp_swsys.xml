<?xml version="1.0" encoding="utf-8" ?>

<swsys>
    <expected_iterface name="TLM1" dev_path="/dev/ttyS1"/>

    <bus name="control" eq_channel="1" max_topics="256"/>
    <bus name="gcu" eq_channel="0" max_topics="256">
        <event_queue buffer_size="4000" size="16"/>

        <dir name="hk" eq_channel="16"/>
        <dir name="nav" eq_channel="16"/>
        <dir name="cont" eq_channel="16"/>
    </bus>

    <task type="flow" config="mvp_flow_control.xml" name="control_flow" priority="6" clk_method="freerun">
        <connect>
            <out alias="wx">control/wx</out>
            <out alias="wy">control/wy</out>
            <out alias="wz">control/wz</out>
            <out alias="ax">control/ax</out>
            <out alias="ay">control/ay</out>
            <out alias="az">control/az</out>
            <out alias="roll">control/roll</out>
            <out alias="pitch">control/pitch</out>
            <out alias="yaw">control/yaw</out>
            <out alias="ax">control/roll</out>
            <out alias="ay">control/pitch</out>
            <out alias="az">control/yaw</out>
            <out alias="arm">control/arm</out>
            <out alias="manc_lat">control/manc_lat</out>
            <out alias="manc_lon">control/manc_lon</out>
            <out alias="manc_thr">control/manc_thr</out>
            <out alias="manc_rud">control/manc_rud</out>
            <out alias="manc_pids_tune">control/manc_pids_tune</out>
        </connect>
    </task>

    <task type="flow" config="mvp_flow_telemetric.xml" name="telemetric" priority="1" clk_method="timer" clk_period="100">
        <connect>
            <in alias="wx">control/wx</in>
            <in alias="wy">control/wy</in>
            <in alias="wz">control/wz</in>
            <in alias="ax">control/ax</in>
            <in alias="ay">control/ay</in>
            <in alias="az">control/az</in>
            <in alias="roll">control/roll</in>
            <in alias="pitch">control/pitch</in>
            <in alias="yaw">control/yaw</in>
            <in alias="manc_lat">control/manc_lat</in>
            <in alias="manc_lon">control/manc_lon</in>
            <in alias="manc_thr">control/manc_thr</in>
            <in alias="manc_rud">control/manc_rud</in>
            <in alias="manc_pids_tune">control/manc_pids_tune</in>
            <in alias="manc_arm">control/arm</in>

            <out alias="sine">gcu/hk/sine</out>
        </connect>
    </task>

    <task type="flow" config="flow_nav_attitude.xml" name="nav_attitude" priority="5" clk_method="freerun"/>
    <task type="flow" config="flow_control_attitude.xml" name="control_attitude" priority="5" clk_method="freerun"/>
    <task type="flow" config="flow_remote_control_source.xml" name="remote_control_source" priority="5" clk_method="freerun"/>

    <bridge name="nav" priority="2" clk_method="timer" clk_period="100" to="gcu/nav">
        <source alias="wx, wy, wz, ax, ay, az">control/$alias</source>
        <source alias="roll, pitch, yaw">control/$alias</source>
    </bridge>

    <bridge name="man_cont" priority="2" clk_method="timer" clk_period="100" to="gcu/cont">
        <source alias="manc_lat, manc_lon, manc_thr, manc_rud">control/$alias</source>
        <source alias="manc_pids_knob">control/manc_pids_tune</source>
        <source alias="manc_arm">control/arm</source>
    </bridge>

    <service type="sdtl" name="gcu_link">
        <baudrate value="57600"/>

        <serial value="/dev/ttyS1"/>

        <channel id="1" name="downlink" type="rel"/>
        <channel id="2" name="downlink_sk" type="unrel"/>
    </service>

    <service type="eqrb_sdtl" name="debug_sdtl">
        <event_queue_source value="gcu"/>

        <sdtl_service value="gcu_link"/>

        <channel_1_name value="downlink"/>

        <channel_2_name value="downlink_sk"/>
    </service>
</swsys>
